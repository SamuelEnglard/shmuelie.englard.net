import{dataBindWidget}from"./contact-widgets.js";import{isArray,isElement,isSchemaType}from"./type-guards.js";import{formatDateTime,formatPhone}from"./formatters.js";function getElementType(t){for(;!t.hasAttribute("itemscope");){if(null===t.parentElement)return null;t=t.parentElement}const e=t.getAttribute("itemtype");if(null===e)return null;return e.substr("https://schema.org/".length)}function getProperty(t,e){return e in t?t[e]:null}export function dataBind(t,e){if("string"==typeof e)dataBindAsString(t,e);else if(isArray(e))dataBindAsArray(t,e);else{const r=getElementType(t);if(null===r)throw new Error("Unknown element data type");if(r!==e["@type"])throw new Error("Data type does not match element type");if(t.dataset.formatter&&t.dataset.formatter in thingFormatters&&thingFormatters[t.dataset.formatter](e,t))return;for(const r of Object.keys(e).filter((t=>!t.startsWith("@")))){const n=getProperty(e,r),a=t.querySelector("*[itemprop="+r+"]");null!==a&&null!==n&&dataBind(a,n)}}}function dataBindAsArray(t,e){for(const r of e){const e="string"==typeof r?t.querySelector("template[data-type=Text]"):t.querySelector("template[data-type="+r["@type"]+"]");if(e&&e.content.firstElementChild){const n=e.content.firstElementChild.cloneNode(!0);dataBind(n,r),t.appendChild(n)}}}function dataBindAsString(t,e){t.dataset.formatter&&t.dataset.formatter in stringFormatters&&stringFormatters[t.dataset.formatter](e,t)||(t.innerText=e)}function dateFormatter(t,e){return!!isElement(e,"time")&&(e.innerText=formatDateTime(t),e.dateTime=t,!0)}function emailFormatter(t,e){return!(!isElement(e,"a")||!/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/.test(t))&&(e.href="mailto:"+t,e.innerText=t,!0)}function telephoneFormatter(t,e){if(isElement(e,"a")){const r=formatPhone(t);if(r)return e.href=r.link,e.innerText=r.display,!0}return!1}function anchorFormatter(t,e){return!!isElement(e,"a")&&(e.href=t,!0)}function metaFormatter(t,e){return!!isElement(e,"meta")&&(e.content=t,!0)}function imageFormatter(t,e){return!!isElement(e,"img")&&(e.src=t,!0)}function contactPointFormatter(t,e){return isSchemaType(t,"ContactPoint")&&e.appendChild(dataBindWidget(t)),!1}export const stringFormatters={date:dateFormatter,meta:metaFormatter,image:imageFormatter,email:emailFormatter,telephone:telephoneFormatter,anchor:anchorFormatter};export const thingFormatters={contactPoint:contactPointFormatter};export function jsonLdBind(t,e){const r=e.querySelector("script[type='application/ld+json']");r&&(r.text=JSON.stringify(t))}
//# sourceMappingURL=schema-binding.js.map
